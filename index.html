<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>成长日签 | Growth Daily</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel Standalone for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Importing playful, bold fonts */
      @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;500;700&display=swap');
      
      body {
        font-family: 'Fredoka', 'Noto Sans SC', sans-serif;
        overflow: hidden; /* Prevent scrolling on body */
      }
      
      /* Special font for Titles */
      .pop-font {
        font-family: 'ZCOOL KuaiLe', 'Fredoka', cursive;
      }
      
      /* 3D Transform Utilities */
      .perspective-1000 { perspective: 1000px; }
      .transform-style-3d { transform-style: preserve-3d; }
      .backface-hidden { backface-visibility: hidden; }
      .rotate-y-180 { transform: rotateY(180deg); }
      
      /* Holographic glitter effect */
      .holo-sheen {
        background: linear-gradient(
          135deg, 
          rgba(255,255,255,0) 0%, 
          rgba(255,255,255,0.4) 25%, 
          rgba(255,255,255,0) 50%, 
          rgba(255,255,255,0) 100%
        );
        background-size: 200% 200%;
        animation: sheen 3s infinite linear;
      }

      @keyframes sheen {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      
      /* Utilities */
      .touch-none { touch-action: none; }
      
      /* Custom Scrollbar hiding */
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
  <body class="bg-sky-300 text-slate-800">
    <div id="root"></div>

    <!-- Main Application Script with data-type="module" to fix import errors -->
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useEffect, useMemo, useCallback, useRef } from 'https://esm.sh/react@18.2.0';
      import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
      import { GoogleGenAI, Type } from 'https://esm.sh/@google/genai@0.1.1';
      import { Sparkles, Star, Zap, Heart, Cloud, RotateCcw, Play, Key, Settings, Lock } from 'https://esm.sh/lucide-react@0.263.1';

      // --- DATA: Static Cards (Merged from data/staticCards.ts) ---
      const STATIC_CARDS = [
        { title: "好运加满", wisdom: "宇宙接收到了你的信号，请查收！", action: "给自己买束花，或者换个好看的壁纸", themeColor: "#F472B6" },
        { title: "拒绝内耗", wisdom: "你的能量很贵，别浪费在不值得的事上。", action: "关闭朋友圈入口，或者发呆5分钟", themeColor: "#A855F7" },
        { title: "原地起飞", wisdom: "芜湖！今天的快乐是过山车级别的！", action: "听一首超嗨的歌，跟着扭一扭", themeColor: "#38BDF8" },
        { title: "禁止焦绿", wisdom: "把烦恼丢进垃圾桶，把心情晾在太阳下。", action: "吃个绿色的水果（奇异果/青提）", themeColor: "#A3E635" },
        { title: "今日躺平", wisdom: "休息是为了更好地摸鱼（划掉）出发。", action: "这种天气适合睡个午觉，或者点个外卖", themeColor: "#FACC15" },
        { title: "搞钱要紧", wisdom: "何以解忧，唯有暴富。你也是某种财富。", action: "检查一下余额，或者存下5块钱", themeColor: "#FB923C" },
        { title: "超级加倍", wisdom: "快乐会传染，霉运会滚蛋。", action: "给好朋友发个表情包，或者分享一个笑话", themeColor: "#F472B6" },
        { title: "闪闪发光", wisdom: "你是银河系遗落在地球的星星。", action: "照镜子大声说“我真好看”", themeColor: "#38BDF8" },
        { title: "稳住能赢", wisdom: "一切都是最好的安排，别急，让子弹飞一会儿。", action: "喝一杯温水，深呼吸三次", themeColor: "#A855F7" },
        { title: "诸事皆宜", wisdom: "今天运气爆棚，干啥都行！", action: "想做什么现在就去做（比如喝奶茶）", themeColor: "#FACC15" },
        { title: "恋爱脑退散", wisdom: "智者不入爱河，建设美丽祖国。", action: "专注于手头的工作/学习十分钟", themeColor: "#FB923C" },
        { title: "水逆退散", wisdom: "坏运气通通弹开！Biubiubiu！", action: "整理一下桌面，或者扔掉一个不需要的东西", themeColor: "#38BDF8" },
        { title: "保持可爱", wisdom: "可爱可以抵挡一切不可爱。", action: "拍一张天空的照片，或者路边的小猫", themeColor: "#F472B6" },
        { title: "立刻行动", wisdom: "犹豫就会败北，冲就完事了。", action: "完成那个拖了很久的小事（3分钟内）", themeColor: "#A3E635" },
        { title: "早点睡觉", wisdom: "熬夜会变丑，睡觉是美容。", action: "今晚比昨天早睡30分钟", themeColor: "#A855F7" },
        { title: "相信直觉", wisdom: "你的第一反应通常是对的。", action: "用硬币抛个正反面决定那件纠结的事", themeColor: "#38BDF8" },
        { title: "你是自由的", wisdom: "不用讨好任何人，除了你自己。", action: "拒绝一个不想去的聚会或请求", themeColor: "#FACC15" },
        { title: "接受不完美", wisdom: "小瑕疵也是一种风格。", action: "允许自己今天偷个小懒", themeColor: "#FB923C" },
        { title: "充满希望", wisdom: "转角遇到爱（或者奶茶店）。", action: "对陌生人或店员笑一下", themeColor: "#F472B6" },
        { title: "记得喝水", wisdom: "水是生命之源，皮肤好的秘诀。", action: "现在，立刻，拿起杯子喝一口", themeColor: "#38BDF8" },
        { title: "做个小孩", wisdom: "大人的世界太无聊，不如做回小孩。", action: "买个吹泡泡机，或者去荡秋千", themeColor: "#FACC15" },
        { title: "允许发疯", wisdom: "偶尔发疯有益身心健康。", action: "在家里没人的时候大叫一声", themeColor: "#A855F7" },
        { title: "开怀大笑", wisdom: "笑声是最好的化妆品。", action: "看那个你收藏很久的搞笑视频", themeColor: "#F472B6" },
        { title: "游戏人间", wisdom: "别太当真，地球也就是个巨大的游乐场。", action: "玩一局很久没玩的游戏", themeColor: "#38BDF8" },
        { title: "极致放松", wisdom: "松弛感不是演出来的，是瘫出来的。", action: "用最舒服的姿势躺在沙发上不动", themeColor: "#A3E635" },
        { title: "保持好奇", wisdom: "世界很有趣，如果你愿意多看一眼。", action: "走一条平时没走过的路回家", themeColor: "#FB923C" },
        { title: "甜蜜暴击", wisdom: "生活苦短，必须加糖。", action: "吃那个你一直忍着没吃的甜点", themeColor: "#F472B6" },
        { title: "亲近自然", wisdom: "你的身体需要大地的能量充值。", action: "抱一棵树，或者摸摸路边的小草", themeColor: "#A3E635" },
        { title: "味蕾探险", wisdom: "把惊喜交给舌尖。", action: "去便利店买一种从没喝过的饮料", themeColor: "#FACC15" },
        { title: "浴室歌王", wisdom: "你的浴室就是红馆/鸟巢。", action: "洗澡时大声唱首最爱的歌", themeColor: "#38BDF8" },
        { title: "颜值爆表", wisdom: "今日运势：美得不可方物。", action: "自拍三张，选最好看的那张欣赏一下", themeColor: "#F472B6" },
        { title: "房间蹦迪", wisdom: "身体知道答案，动起来就开心了。", action: "放首舞曲，在房间里乱跳两分钟", themeColor: "#A855F7" },
        { title: "自我宠爱", wisdom: "对自己好不需要理由。", action: "给自己点一份豪华版早餐/下午茶", themeColor: "#FB923C" },
        { title: "睡个好觉", wisdom: "没什么是一场深睡眠解决不了的。", action: "换上最舒服的睡衣，今晚早睡一小时", themeColor: "#38BDF8" },
        { title: "灵魂充电", wisdom: "书是随身携带的避难所。", action: "读几页书，哪怕只有5分钟", themeColor: "#A855F7" },
        { title: "记录美好", wisdom: "被记录下来的瞬间才是永恒。", action: "写下今天发生的3件微小好事", themeColor: "#FACC15" },
        { title: "随便画画", wisdom: "涂鸦是潜意识在说话。", action: "拿笔在纸上乱画，火柴人也行", themeColor: "#A3E635" },
        { title: "动动身体", wisdom: "流汗是脂肪在流泪。", action: "做20个开合跳，或者拉伸一下", themeColor: "#FB923C" },
        { title: "奖励自己", wisdom: "钱不是花了，是变成了喜欢的样子陪你。", action: "清空购物车里的一样小东西", themeColor: "#F472B6" },
        { title: "断舍离", wisdom: "旧的不去，新的不来。", action: "扔掉一件不再心动的旧物", themeColor: "#38BDF8" },
        { title: "朋友聚聚", wisdom: "人类是社会性动物，你需要抱抱。", action: "约那个很久没见的朋友喝杯咖啡", themeColor: "#FACC15" },
        { title: "享受独处", wisdom: "安静是最高级的奢华。", action: "关掉手机网络，静坐5分钟", themeColor: "#A855F7" },
        { title: "怀旧时刻", wisdom: "回忆是时光机。", action: "听一首十年前喜欢的老歌", themeColor: "#FB923C" },
        { title: "护眼行动", wisdom: "眼睛是心灵的窗户，别让它太累。", action: "眺望远方，找找绿色的东西", themeColor: "#A3E635" },
        { title: "香气疗愈", wisdom: "气味是记忆和情绪的开关。", action: "点个香薰，或者闻闻水果的香气", themeColor: "#F472B6" },
        { title: "毛绒治愈", wisdom: "柔软的东西能融化心里的冰。", action: "摸摸毛茸茸的东西（猫/狗/毯子）", themeColor: "#FACC15" },
        { title: "脑洞大开", wisdom: "无用之用，方为大用。", action: "去搜索一个奇奇怪怪的冷知识", themeColor: "#38BDF8" },
        { title: "焕然一新", wisdom: "微小的改变带来全新的气场。", action: "换个头像，或者换个发型/口红颜色", themeColor: "#A855F7" },
        { title: "大脑放空", wisdom: "发呆是给大脑做SPA。", action: "看窗外的云/树叶发呆3分钟", themeColor: "#A3E635" },
        { title: "相信未来", wisdom: "最好的还没发生呢，期待一下。", action: "在日历上标记一个值得期待的日子", themeColor: "#FB923C" }
      ];

      const getRandomStaticCard = () => {
        const randomIndex = Math.floor(Math.random() * STATIC_CARDS.length);
        return STATIC_CARDS[randomIndex];
      };

      // --- SERVICE: Gemini Logic ---
      const generateOracleGuidance = async (apiKey) => {
        // If no API key provided, use local mode
        if (!apiKey) {
          console.log("Using Local Mode (Static Cards)");
          return new Promise(resolve => setTimeout(() => resolve(getRandomStaticCard()), 800)); // Fake network delay
        }

        try {
          const ai = new GoogleGenAI({ apiKey: apiKey });
          const response = await ai.models.generateContent({
            model: 'gemini-2.0-flash', 
            contents: {
              parts: [{
                text: "为一位年轻女性生成一张‘今日成长日签’。风格要是：元气、快乐、多巴胺风格、简短有力。像海报或贴纸上的标语。内容关注：自我肯定、行动力、开心生活。请使用简体中文回复。返回JSON格式，包含 title, wisdom, action, themeColor。"
              }]
            },
            config: {
              responseMimeType: "application/json",
              responseSchema: {
                type: Type.OBJECT,
                properties: {
                  title: { type: Type.STRING, description: "极短的、像贴纸一样的标题，最好2-5个字。" },
                  wisdom: { type: Type.STRING, description: "一句俏皮、充满能量的鼓励。" },
                  action: { type: Type.STRING, description: "一个具体的、能让人开心的微小行动。" },
                  themeColor: { type: Type.STRING, description: "波普颜色代码Hex。" }
                },
                required: ["title", "wisdom", "action", "themeColor"],
              },
            },
          });

          if (response.text) {
             return JSON.parse(response.text);
          }
          throw new Error("No response");
        } catch (error) {
          console.error("Gemini Error, falling back:", error);
          return getRandomStaticCard();
        }
      };

      // --- COMPONENT: Sticker ---
      const Sticker = ({ type, className }) => {
        const Icon = type === 'star' ? Star : type === 'zap' ? Zap : type === 'heart' ? Heart : Sparkles;
        return (
          <div className={`absolute ${className} drop-shadow-sm pointer-events-none`}>
             <Icon fill="currentColor" className="w-full h-full" strokeWidth={2.5} />
          </div>
        );
      };

      // --- COMPONENT: Card ---
      const POP_THEMES = [
        { bg: "bg-pink-400", border: "border-pink-200", text: "text-white", accent: "text-yellow-300" },
        { bg: "bg-yellow-400", border: "border-yellow-200", text: "text-pink-600", accent: "text-blue-400" },
        { bg: "bg-sky-400", border: "border-sky-200", text: "text-white", accent: "text-yellow-300" },
        { bg: "bg-purple-400", border: "border-purple-200", text: "text-white", accent: "text-green-300" },
        { bg: "bg-lime-400", border: "border-lime-200", text: "text-purple-600", accent: "text-pink-400" },
      ];

      const Card = ({ id, index, totalCards, state, isFlipped, content, onClick }) => {
        const [windowWidth, setWindowWidth] = useState(typeof window !== 'undefined' ? window.innerWidth : 1000);

        useEffect(() => {
          const handleResize = () => setWindowWidth(window.innerWidth);
          window.addEventListener('resize', handleResize);
          return () => window.removeEventListener('resize', handleResize);
        }, []);

        const isMobile = windowWidth < 768;

        const randomValues = useMemo(() => ({
          rot: (id % 5) - 2, 
          shufX: (Math.sin(id * 99) * (isMobile ? 80 : 200)),
          shufRot: (Math.cos(id * 50) * 45)
        }), [id, isMobile]);

        const style = useMemo(() => {
          let transform = '';
          let zIndex = index;
          let opacity = 1;
          let transition = 'all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
          let top = '50%';
          let left = '50%';
          let transformOrigin = 'center center';

          if (state === 'stacked') {
            transform = `translate(-50%, -50%) rotate(${randomValues.rot}deg) translateY(${-index * 0.1}px)`;
          } else if (state === 'shuffling') {
            transform = `translate(calc(-50% + ${randomValues.shufX}px), -50%) rotate(${randomValues.shufRot}deg)`;
            transition = 'all 0.4s ease-in-out';
          } else if (state === 'spread') {
            // Fan Spread Logic
            const spreadWidth = Math.min(windowWidth * 0.95, 1000); 
            const centerIdx = (totalCards - 1) / 2;
            const relativeIdx = index - centerIdx; 
            
            const xSpacing = spreadWidth / totalCards;
            const xPos = relativeIdx * xSpacing;
            
            const rotFactor = isMobile ? 1.0 : 2.0;
            const rot = relativeIdx * rotFactor;
            
            const yCurveFactor = isMobile ? 0.1 : 0.25; 
            const yPos = Math.pow(Math.abs(relativeIdx), 2) * yCurveFactor;
            const yCenterOffset = isMobile ? 20 : 0;

            transform = `translate(calc(-50% + ${xPos}px), calc(-50% + ${yPos + yCenterOffset}px)) rotate(${rot}deg)`;
          } else if (state === 'selected') {
            const scale = 1.0; 
            transform = `translate(-50%, -50%) scale(${scale}) rotate(0deg)`;
            zIndex = 1000;
            transition = 'all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
          } else if (state === 'hidden') {
            transform = `translate(-50%, 150vh)`;
            opacity = 0;
          }

          return {
            position: 'absolute',
            top,
            left,
            transform,
            transformOrigin,
            zIndex,
            opacity,
            transition,
            cursor: state === 'spread' ? 'pointer' : 'default'
          };
        }, [state, index, totalCards, id, windowWidth, isMobile, randomValues]);

        const theme = POP_THEMES[id % POP_THEMES.length];
        
        const decorations = useMemo(() => {
          return [
            { type: 'star', color: theme.accent, size: 'w-6 h-6 md:w-8 md:h-8', pos: 'top-4 right-4 rotate-12' },
            { type: 'sparkle', color: 'text-white', size: 'w-4 h-4 md:w-6 md:h-6', pos: 'top-12 left-6 -rotate-12 opacity-80' },
            { type: 'heart', color: 'text-rose-400', size: 'w-4 h-4 md:w-5 md:h-5', pos: 'bottom-20 right-8 rotate-45' },
          ];
        }, [theme]);

        const sizeClasses = "w-[75vw] h-[55vh] md:w-[300px] md:h-[440px] max-w-[320px] max-h-[500px]";

        return (
          <div 
            style={style}
            className={`perspective-1000 group ${sizeClasses}
                        ${state === 'spread' ? 'hover:z-[50] hover:-translate-y-6 transition-transform' : ''}`}
            onClick={() => state === 'spread' && onClick(id)}
          >
            <div 
              className={`relative w-full h-full text-center transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}
            >
              {/* BACK */}
              <div className={`absolute w-full h-full backface-hidden rounded-[20px] md:rounded-[30px] overflow-hidden border-[4px] md:border-4 border-white shadow-xl md:shadow-2xl ${theme.bg}`}>
                 <div className="absolute inset-0 opacity-20" style={{ backgroundImage: 'radial-gradient(circle, #fff 2px, transparent 2px)', backgroundSize: '20px 20px' }} />
                 <div className="w-full h-full flex flex-col items-center justify-center relative z-10">
                    <div className="w-16 h-16 md:w-24 md:h-24 bg-white rounded-full flex items-center justify-center shadow-lg border-4 border-opacity-20 border-black mb-4 animate-pulse">
                       <Cloud className={`${theme.bg.replace('bg-', 'text-')} w-8 h-8 md:w-12 md:h-12`} fill="currentColor" />
                    </div>
                    <span className="pop-font text-white text-xl md:text-2xl tracking-widest font-bold drop-shadow-md">GROWTH</span>
                 </div>
                 <div className="holo-sheen absolute inset-0 pointer-events-none opacity-40" />
              </div>

              {/* FRONT */}
              <div className={`absolute w-full h-full backface-hidden rotate-y-180 rounded-[20px] md:rounded-[30px] overflow-hidden bg-white flex flex-col border-[6px] md:border-8 border-white shadow-xl md:shadow-2xl`}>
                <div className={`flex-grow relative ${theme.bg} flex flex-col items-center justify-center p-4 overflow-hidden`}>
                   <div className="absolute top-[-50px] left-[-50px] w-32 h-32 md:w-40 md:h-40 bg-white opacity-10 rounded-full blur-xl" />
                   <div className="absolute bottom-[-20px] right-[-20px] w-24 h-24 md:w-32 md:h-32 bg-yellow-300 mix-blend-overlay opacity-30 rounded-full blur-xl" />
                   
                   {(state === 'selected') && decorations.map((d, i) => (
                     <Sticker key={i} type={d.type} className={`${d.color} ${d.size} ${d.pos}`} />
                   ))}

                   {content ? (
                      <>
                        <div className="relative z-10 w-full flex flex-col items-center justify-center h-full">
                          <h2 className={`pop-font text-4xl md:text-6xl font-bold leading-tight break-words w-full text-center drop-shadow-[2px_2px_0px_rgba(0,0,0,0.1)] ${theme.text} mb-3`}>
                            {content.title}
                          </h2>
                          <div className="w-12 md:w-16 h-1.5 bg-white/50 rounded-full my-3 md:my-4" />
                          <p className={`text-sm md:text-base font-bold opacity-90 px-2 md:px-4 leading-relaxed ${theme.text}`}>
                             {content.wisdom}
                          </p>
                        </div>
                      </>
                   ) : (
                      <Sparkles className="animate-spin text-white w-8 h-8 md:w-10 md:h-10" />
                   )}
                </div>

                <div className="min-h-[25%] bg-white w-full flex flex-col items-center justify-center p-4 relative z-20">
                   <div className="absolute top-[-8px] md:top-[-10px] left-1/2 -translate-x-1/2 w-4 h-4 md:w-6 md:h-6 bg-white rotate-45 transform" />
                   {content && (
                     <>
                       <span className="text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Today's Action</span>
                       <p className="text-slate-800 font-bold text-center leading-tight pop-font text-lg md:text-xl">{content.action}</p>
                     </>
                   )}
                </div>
                <div className="absolute inset-0 bg-noise opacity-[0.03] pointer-events-none mix-blend-multiply" />
              </div>
            </div>
          </div>
        );
      };

      // --- COMPONENT: API Key Modal ---
      const ApiKeyModal = ({ isOpen, onSave, onLocalMode }) => {
        const [inputKey, setInputKey] = useState("");

        if (!isOpen) return null;

        return (
          <div className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
            <div className="bg-white rounded-3xl p-6 md:p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-300">
              <div className="flex flex-col items-center text-center space-y-4">
                <div className="w-12 h-12 bg-sky-100 rounded-full flex items-center justify-center mb-2">
                  <Key className="w-6 h-6 text-sky-500" />
                </div>
                <h2 className="text-2xl font-bold text-slate-800 pop-font">设置 API Key</h2>
                <p className="text-slate-500 text-sm">
                  为了体验 AI 生成的实时指引，请输入您的 Google Gemini API Key。<br/>
                  (Key 仅保存在您的浏览器本地，不会上传)
                </p>
                
                <input 
                  type="password" 
                  value={inputKey}
                  onChange={(e) => setInputKey(e.target.value)}
                  placeholder="Paste your API Key here..."
                  className="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-sky-400 focus:outline-none transition-colors"
                />

                <button 
                  onClick={() => onSave(inputKey)}
                  disabled={!inputKey}
                  className="w-full py-3 bg-sky-500 text-white rounded-xl font-bold shadow-md hover:bg-sky-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                >
                  确认并开始
                </button>

                <div className="relative w-full py-2">
                  <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-slate-200"></div></div>
                  <div className="relative flex justify-center text-xs uppercase"><span className="bg-white px-2 text-slate-400">或者</span></div>
                </div>

                <button 
                  onClick={onLocalMode}
                  className="text-slate-400 hover:text-slate-600 text-sm font-semibold flex items-center gap-2"
                >
                  <Lock className="w-3 h-3" /> 使用离线模式 (50张精选卡牌)
                </button>
              </div>
            </div>
          </div>
        );
      };

      // --- COMPONENT: Settings Button ---
      const SettingsButton = ({ onClick }) => (
        <button 
          onClick={onClick}
          className="absolute top-4 right-4 z-50 p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/40 transition-all"
        >
          <Settings className="w-5 h-5" />
        </button>
      );

      // --- COMPONENT: OracleDeck ---
      const OracleDeck = () => {
        const [deckState, setDeckState] = useState('intro');
        const [selectedCardId, setSelectedCardId] = useState(null);
        const [oracleContent, setOracleContent] = useState(null);
        const [isFlipped, setIsFlipped] = useState(false);
        const [loading, setLoading] = useState(false);
        const [breathingText, setBreathingText] = useState("");
        
        // API Key State
        const [apiKey, setApiKey] = useState("");
        const [showKeyModal, setShowKeyModal] = useState(false);
        const [isLocalMode, setIsLocalMode] = useState(false);

        useEffect(() => {
          const storedKey = localStorage.getItem("gemini_api_key");
          if (storedKey) {
            setApiKey(storedKey);
          } else {
            // Delay modal slightly for smooth entry
            setTimeout(() => setShowKeyModal(true), 500);
          }
        }, []);

        const handleSaveKey = (key) => {
          localStorage.setItem("gemini_api_key", key);
          setApiKey(key);
          setShowKeyModal(false);
          setIsLocalMode(false);
        };

        const handleLocalMode = () => {
          setIsLocalMode(true);
          setShowKeyModal(false);
        };

        const openSettings = () => setShowKeyModal(true);

        const preFetchOracle = useCallback(async () => {
          try {
            // If local mode or no key, this function handles fallback internally
            const data = await generateOracleGuidance(isLocalMode ? null : apiKey);
            setOracleContent(data);
          } catch (e) {
            console.error(e);
            setOracleContent(getRandomStaticCard());
          }
        }, [apiKey, isLocalMode]);

        const handleShuffle = () => {
          setDeckState('shuffling');
          setLoading(true);
          setBreathingText("Mixing energy...");
          
          preFetchOracle();

          setTimeout(() => {
            setDeckState('spread');
            setLoading(false);
            setBreathingText("Pick a card");
            setTimeout(() => setBreathingText("Trust your vibe..."), 2500);
          }, 1500); 
        };

        const handleCardClick = (id) => {
          if (deckState !== 'spread') return;
          setSelectedCardId(id);
          setDeckState('drawing');
          setBreathingText(""); 

          setTimeout(() => {
            setDeckState('revealed');
            setIsFlipped(true);
          }, 800);
        };

        const resetDeck = () => {
          setIsFlipped(false);
          setTimeout(() => {
              setSelectedCardId(null);
              setOracleContent(null);
              setDeckState('intro');
              setBreathingText("");
          }, 600);
        };

        const cards = Array.from({ length: 50 }, (_, i) => i);

        return (
          <div className="relative w-full h-screen flex flex-col items-center justify-center overflow-hidden touch-none bg-transparent">
            
            <ApiKeyModal isOpen={showKeyModal} onSave={handleSaveKey} onLocalMode={handleLocalMode} />
            
            {!showKeyModal && <SettingsButton onClick={openSettings} />}

            {/* Pop Style Title (Top of screen) - For Shuffling/Picking States */}
            <div className={`absolute top-10 md:top-16 z-20 transition-all duration-1000 ${breathingText ? 'scale-110 opacity-100' : 'scale-90 opacity-0'} px-4 w-full flex justify-center pointer-events-none`}>
               <div className="bg-white/90 backdrop-blur-sm px-6 py-2 rounded-full shadow-xl border-2 border-white transform -rotate-1">
                    <p className="text-lg md:text-2xl text-sky-500 font-bold pop-font tracking-wide text-center">
                       {breathingText}
                    </p>
               </div>
            </div>

            {/* Intro Title & Subtitle - Top Position (Only in Intro) */}
            {deckState === 'intro' && (
              <div className="absolute top-16 md:top-24 flex flex-col items-center gap-3 z-30 animate-in slide-in-from-top-10 duration-1000 w-full px-4 pointer-events-none">
                  <h1 className="text-6xl md:text-8xl font-bold pop-font text-white drop-shadow-[0_4px_0_rgba(0,0,0,0.1)] transform -rotate-3">
                    Growth Daily
                  </h1>
                  <div className="bg-white/20 backdrop-blur-md px-6 py-2 rounded-full border border-white/40 shadow-sm mt-2">
                    <p className="text-white font-bold text-lg md:text-xl tracking-widest drop-shadow-md">
                      抽取你的今日指引
                    </p>
                  </div>
              </div>
            )}

            {/* Main Deck Container */}
            <div className="relative w-full h-full flex items-center justify-center perspective-1000">
              {cards.map((id, index) => (
              <Card
                  key={id}
                  id={id}
                  index={index}
                  totalCards={50}
                  state={
                  deckState === 'intro' ? 'stacked' :
                  deckState === 'shuffling' ? 'shuffling' :
                  deckState === 'spread' ? 'spread' :
                  deckState === 'drawing' && selectedCardId === id ? 'selected' :
                  deckState === 'revealed' && selectedCardId === id ? 'selected' :
                  'hidden'
                  }
                  isFlipped={selectedCardId === id && isFlipped}
                  content={selectedCardId === id ? oracleContent : null}
                  onClick={handleCardClick}
              />
              ))}
            </div>

            {/* Intro Button */}
            {deckState === 'intro' && (
              <div className="absolute bottom-24 md:bottom-32 flex flex-col items-center gap-6 z-30 animate-in slide-in-from-bottom-20 duration-1000 w-full px-4 pointer-events-auto">
                 <button
                   onClick={handleShuffle}
                   className="group relative px-8 py-3 md:px-10 md:py-4 bg-yellow-400 text-yellow-900 font-bold text-lg md:text-xl rounded-full shadow-[0_6px_0_rgb(202,138,4)] hover:shadow-[0_3px_0_rgb(202,138,4)] hover:translate-y-[3px] active:scale-95 transition-all flex items-center gap-3 pop-font border-4 border-white"
                 >
                   <Play className="w-5 h-5 md:w-6 md:h-6 fill-current" />
                   <span>开始抽取</span>
                 </button>
              </div>
            )}

            {/* Reset Button */}
            {deckState === 'revealed' && (
              <div className="absolute bottom-20 md:bottom-28 z-50 animate-in fade-in duration-500 delay-500 pointer-events-auto">
                 <button
                   onClick={resetDeck}
                   className="bg-white text-slate-800 px-6 py-3 rounded-full font-bold shadow-lg hover:bg-slate-50 active:scale-95 transition-all flex items-center gap-2 border-2 border-slate-100"
                 >
                   <RotateCcw className="w-5 h-5 text-sky-500" />
                   再抽一张
                 </button>
              </div>
            )}
          </div>
        );
      };

      // --- APP COMPONENT ---
      const App = () => {
        return (
          <main className="relative w-full h-screen bg-gradient-to-b from-sky-400 to-sky-200 overflow-hidden">
            {/* Ambient BGs */}
            <div className="absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-white opacity-20 rounded-full blur-[100px] pointer-events-none" />
            <div className="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-sky-100 opacity-30 rounded-full blur-[80px] pointer-events-none" />
            
            {/* Noise */}
            <div className="absolute inset-0 opacity-[0.04] pointer-events-none" 
                 style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E")` }} 
            />

            <OracleDeck />
          </main>
        );
      };

      // --- MOUNT ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
