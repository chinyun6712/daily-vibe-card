<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>成长日签 | Growth Daily</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;500;700&display=swap');
      body { font-family: 'Fredoka', 'Noto Sans SC', sans-serif; overflow: hidden; background-color: #7dd3fc; }
      .pop-font { font-family: 'ZCOOL KuaiLe', 'Fredoka', cursive; }
      .perspective-1000 { perspective: 1000px; }
      .transform-style-3d { transform-style: preserve-3d; }
      .backface-hidden { backface-visibility: hidden; }
      .rotate-y-180 { transform: rotateY(180deg); }
      .holo-sheen {
        background: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 25%, rgba(255,255,255,0) 50%, rgba(255,255,255,0) 100%);
        background-size: 200% 200%;
        animation: sheen 3s infinite linear;
      }
      @keyframes sheen { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-sky-300 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

      const { useState, useEffect, useMemo, useCallback } = React;
      const { createRoot } = ReactDOM;

      // 静态卡片数据
      const STATIC_CARDS = [
        { title: "好运加满", wisdom: "宇宙接收到了你的信号，请查收！", action: "给自己买束花，或者换个好看的壁纸", themeColor: "#F472B6" },
        { title: "拒绝内耗", wisdom: "你的能量很贵，别浪费在不值得的事上。", action: "关闭朋友圈入口，或者发呆5分钟", themeColor: "#A855F7" },
        { title: "原地起飞", wisdom: "芜湖！今天的快乐是过山车级别的！", action: "听一首超嗨的歌，跟着扭一扭", themeColor: "#38BDF8" },
        { title: "禁止焦绿", wisdom: "把烦恼丢进垃圾桶，把心情晾在太阳下。", action: "吃个绿色的水果（奇异果/青提）", themeColor: "#A3E635" },
        { title: "今日躺平", wisdom: "休息是为了更好地摸鱼（划掉）出发。", action: "这种天气适合睡个午觉，或者点个外卖", themeColor: "#FACC15" },
        { title: "搞钱要紧", wisdom: "何以解忧，唯有暴富。你也是某种财富。", action: "检查一下余额，或者存下5块钱", themeColor: "#FB923C" },
        { title: "超级加倍", wisdom: "快乐会传染，霉运会滚蛋。", action: "给好朋友发个表情包，或者分享一个笑话", themeColor: "#F472B6" },
        { title: "闪闪发光", wisdom: "你是银河系遗落在地球的星星。", action: "照镜子大声说“我真好看”", themeColor: "#38BDF8" },
        { title: "稳住能赢", wisdom: "一切都是最好的安排，别急，让子弹飞一会儿。", action: "喝一杯温水，深呼吸三次", themeColor: "#A855F7" },
        { title: "诸事皆宜", wisdom: "今天运气爆棚，干啥都行！", action: "想做什么现在就去做（比如喝奶茶）", themeColor: "#FACC15" }
      ];

      // 图标组件 (SVG)
      const Icons = {
        Cloud: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.2-1.3-1-2.4-2.2-3-1.6-.7-3.4-.2-4.4 1.2-1.1-1.6-3.3-2-4.9-1-1.6 1.1-2 3.3-1 4.9.4.7 1.1 1.2 1.9 1.4"/></svg>,
        Sparkles: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
        Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
        RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
        Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
        Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
        Key: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></svg>
      };

      // API Key 弹窗组件
      const ApiKeyModal = ({ isOpen, onSave, onLocalMode }) => {
        const [inputKey, setInputKey] = useState("");
        if (!isOpen) return null;
        return (
          <div className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
            <div className="bg-white rounded-3xl p-6 md:p-8 w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-300">
              <div className="flex flex-col items-center text-center space-y-4">
                <div className="w-12 h-12 bg-sky-100 rounded-full flex items-center justify-center mb-2">
                  <Icons.Key />
                </div>
                <h2 className="text-2xl font-bold text-slate-800 pop-font">设置 API Key</h2>
                <p className="text-slate-500 text-sm">请输入您的 Google Gemini API Key 以体验 AI 占卜。<br/>(Key 仅保存在本地)</p>
                <input type="password" value={inputKey} onChange={(e) => setInputKey(e.target.value)} placeholder="Paste your API Key..." className="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-sky-400 focus:outline-none"/>
                <button onClick={() => onSave(inputKey)} disabled={!inputKey} className="w-full py-3 bg-sky-500 text-white rounded-xl font-bold hover:bg-sky-600 disabled:opacity-50">确认并开始</button>
                <div className="relative w-full py-2">
                   <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-slate-200"></div></div>
                   <div className="relative flex justify-center text-xs uppercase"><span className="bg-white px-2 text-slate-400">或者</span></div>
                </div>
                <button onClick={onLocalMode} className="text-slate-400 hover:text-slate-600 text-sm font-semibold flex items-center gap-2"><Icons.Lock /> 使用离线模式 (随机抽取)</button>
              </div>
            </div>
          </div>
        );
      };

      // 卡片组件
      const POP_THEMES = [
        { bg: "bg-pink-400", text: "text-white" }, { bg: "bg-yellow-400", text: "text-pink-600" },
        { bg: "bg-sky-400", text: "text-white" }, { bg: "bg-purple-400", text: "text-white" },
        { bg: "bg-lime-400", text: "text-purple-600" }
      ];

      const Card = ({ id, index, totalCards, state, isFlipped, content, onClick }) => {
        const theme = POP_THEMES[id % POP_THEMES.length];
        
        const style = useMemo(() => {
          let transform = '';
          let zIndex = index;
          if (state === 'stacked') transform = `translate(-50%, -50%) rotate(${(id % 5) - 2}deg) translateY(${-index * 0.5}px)`;
          else if (state === 'spread') {
             // 简单的扇形展开逻辑
             const angle = (index - totalCards/2) * 5;
             const x = (index - totalCards/2) * 15;
             transform = `translate(calc(-50% + ${x}px), -50%) rotate(${angle}deg)`;
          }
          else if (state === 'selected') { transform = `translate(-50%, -50%) scale(1.1) rotate(0deg)`; zIndex = 1000; }
          else if (state === 'hidden') transform = `translate(-50%, 150vh)`;
          
          return { position: 'absolute', top: '50%', left: '50%', transform, zIndex, transition: 'all 0.6s ease', cursor: state === 'spread' ? 'pointer' : 'default' };
        }, [state, index, totalCards, id]);

        return (
          <div style={style} className="w-[280px] h-[400px] perspective-1000" onClick={() => state === 'spread' && onClick(id)}>
            <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
              {/* 背面 */}
              <div className={`absolute w-full h-full backface-hidden rounded-[30px] border-4 border-white shadow-xl ${theme.bg} flex items-center justify-center`}>
                <div className="text-center"><div className="bg-white/20 p-4 rounded-full mb-2 inline-block"><Icons.Cloud /></div><div className="pop-font text-white text-2xl font-bold">GROWTH</div></div>
              </div>
              {/* 正面 */}
              <div className="absolute w-full h-full backface-hidden rotate-y-180 rounded-[30px] bg-white border-4 border-white shadow-xl flex flex-col overflow-hidden">
                <div className={`flex-1 ${theme.bg} p-6 flex items-center justify-center text-center relative`}>
                   {content ? (
                     <div className="z-10"><h2 className={`pop-font text-4xl font-bold mb-4 ${theme.text}`}>{content.title}</h2><p className={`font-bold opacity-90 ${theme.text}`}>{content.wisdom}</p></div>
                   ) : <Icons.Sparkles className="animate-spin text-white w-8 h-8"/>}
                </div>
                <div className="h-1/3 bg-white p-4 flex flex-col items-center justify-center text-center">
                  <span className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Today's Action</span>
                  <p className="text-slate-800 font-bold pop-font text-lg">{content?.action}</p>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // 主程序
      const App = () => {
        const [deckState, setDeckState] = useState('intro');
        const [selectedId, setSelectedId] = useState(null);
        const [cardContent, setCardContent] = useState(null);
        const [apiKey, setApiKey] = useState(localStorage.getItem("gemini_api_key") || "");
        const [showModal, setShowModal] = useState(!apiKey);

        const handleSaveKey = (key) => { localStorage.setItem("gemini_api_key", key); setApiKey(key); setShowModal(false); };
        
        const fetchAIContent = async () => {
             if (!apiKey) return STATIC_CARDS[Math.floor(Math.random() * STATIC_CARDS.length)];
             try {
                const ai = new GoogleGenerativeAI(apiKey);
                const model = ai.getGenerativeModel({ model: "gemini-1.5-flash" });
                const result = await model.generateContent("为一位年轻女性生成一个‘今日成长日签’。JSON格式包含: title(2-5字), wisdom(一句话), action(小行动), themeColor。风格：元气、快乐。");
                const text = result.response.text();
                // 简单的 JSON 提取逻辑
                const jsonStr = text.match(/\{[\s\S]*\}/)[0];
                return JSON.parse(jsonStr);
             } catch (e) {
                console.error("AI Error", e);
                return STATIC_CARDS[Math.floor(Math.random() * STATIC_CARDS.length)];
             }
        };

        const startDeck = () => {
            setDeckState('spread');
        };

        const pickCard = async (id) => {
            setSelectedId(id);
            setDeckState('selected'); // 先变大
            const content = await fetchAIContent();
            setCardContent(content);
            setTimeout(() => setDeckState('revealed'), 500); // 翻转
        };

        const reset = () => {
            setDeckState('intro');
            setSelectedId(null);
            setCardContent(null);
        };

        return (
          <div className="relative w-full h-screen flex flex-col items-center justify-center overflow-hidden">
            <ApiKeyModal isOpen={showModal} onSave={handleSaveKey} onLocalMode={() => setShowModal(false)} />
            <button onClick={() => setShowModal(true)} className="absolute top-4 right-4 z-50 p-2 bg-white/30 rounded-full"><Icons.Settings /></button>

            {deckState === 'intro' && (
                <div className="absolute top-20 z-10 text-center animate-in slide-in-from-top-10 fade-in duration-700">
                    <h1 className="text-7xl font-bold pop-font text-white drop-shadow-md -rotate-3 mb-4">Growth Daily</h1>
                    <button onClick={startDeck} className="px-8 py-3 bg-yellow-400 text-yellow-900 font-bold rounded-full shadow-lg hover:scale-105 transition-transform flex items-center gap-2 mx-auto"><Icons.Play className="w-5 h-5"/> 开始抽取</button>
                </div>
            )}

            <div className="relative w-full h-full flex items-center justify-center">
                {Array.from({length: 20}).map((_, i) => (
                    <Card 
                        key={i} id={i} index={i} totalCards={20} 
                        state={deckState === 'revealed' && selectedId === i ? 'selected' : (deckState === 'revealed' && selectedId !== i ? 'hidden' : deckState)} 
                        isFlipped={deckState === 'revealed' && selectedId === i}
                        content={cardContent}
                        onClick={pickCard}
                    />
                ))}
            </div>

            {deckState === 'revealed' && (
                <button onClick={reset} className="absolute bottom-20 z-50 px-6 py-3 bg-white text-slate-800 rounded-full font-bold shadow-lg flex items-center gap-2 animate-in fade-in"><Icons.RotateCcw className="w-4 h-4"/> 再抽一张</button>
            )}
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
